# 变更提案: UI Evolution v6（视觉 SSOT 收敛 + 部署稳态 + 交互完善）

## 需求背景

用户反馈集中在两点：

1. GitHub Pages 似乎未持续部署（发布链路不够“可回归/可诊断”）。
2. 界面 UI 存在问题，需要“夸克级别、像素级”的精修与一致性重构。

项目当前以“纯静态稳定交付”为目标，长期采用 `styles.css` 末尾覆盖策略快速演进；随着补丁叠加，出现了多轮 token/组件规则共存的现象：

- 同一类 token 在不同版本块被重复定义，导致主题/强调色切换时的视觉漂移；
- 部分组件（按钮/Chip/Icon Button/卡片）在不同补丁块里存在多次重写，出现“只改一处但另一处仍旧生效”的维护风险；
- 部分全局选择器存在可移植性/兼容性隐患（不同浏览器对复杂选择器支持度不一），可能导致链接/交互反馈在特定页面出现异常。

因此需要一次以“稳定交付”为核心目标的系统性 UI 升级：收敛视觉系统 SSOT、补齐交互闭环、同时让部署链路更明确且可回归。

## 产品分析

### 目标用户与场景

- **玩家（读者）**
  - 场景：快速查找攻略（Command Palette）、浏览游戏库与攻略库、收藏/对比/进度、离线阅读。
  - 期望：信息层级清晰、对比足够、手感统一、在移动端也稳定可用。
- **维护者（站点维护/贡献者）**
  - 场景：维护 `data.js` 数据、补充文档、发布更新并确保缓存穿透与离线刷新不出问题。
  - 期望：UI 规则可维护、变更可回归（门禁通过）、部署路径清晰且稳定。

### 价值主张与成功指标

- **视觉一致性**：主题/高对比/强调色/密度/低动效/低透明等组合下，关键组件（按钮/卡片/导航/面板/输入控件）保持一致的层级与反馈。
- **交互闭环**：Settings Center 支持“只重置外观偏好”，避免用户想修复外观却被迫清空全部本地数据。
- **发布稳态**：明确并固化 GitHub Pages 部署路径（GitHub Actions 或分支部署均可解释），并减少“看起来没部署”的不确定性。
- **质量门禁**：`npm run check:all` 必须持续通过，保证断链/缓存穿透/manifest/sitemap/SW 等关键能力不回退。

### 人文关怀

- **无障碍优先**：聚焦可见（focus ring）、高对比模式可读性优先、动效可降级（Reduced Motion）、透明度可降级（Reduced Transparency）。
- **隐私与合规**：保持 local-first，不引入任何外部跟踪；本地埋点默认仅存本地，可关闭。

## 变更内容

1. **视觉系统 SSOT 收敛**
   - 以“强调色（accent）”作为单一驱动源，统一派生 primary/secondary/glow/fx 等关键 token，减少历史补丁带来的风格漂移。
   - 修复可能导致链接样式/交互反馈异常的全局选择器与细节规则。
2. **Settings Center 交互完善**
   - 新增“仅重置外观偏好”动作（不影响收藏/笔记/进度/回复等业务数据）。
3. **GitHub Pages 部署稳态**
   - 工作流补齐必要的 Pages 配置步骤，文档明确两种部署路径与排障要点。
4. **知识库与变更记录同步**
   - 同步更新项目对外 CHANGELOG 与 HelloAGENTS 知识库记录，确保 SSOT 与代码事实一致。

## 影响范围

- **模块**
  - runtime（`scripts.js` + 偏好系统/设置中心）
  - ui（`styles.css` + token/组件样式）
  - tooling / ci（Pages workflow 稳态）
  - docs（部署与风格规范对齐）
- **文件（预期）**
  - `styles.css`
  - `scripts.js`
  - `.github/workflows/pages.yml`
  - `docs/DEPLOYMENT.md`
  - `docs/STYLE_GUIDE.md`
  - `CHANGELOG.md`
  - `helloagents/CHANGELOG.md`
  - `helloagents/wiki/modules/runtime.md`
  - `helloagents/history/index.md`（迁移后更新索引）
- **API / 数据**
  - 不引入后端 API
  - `localStorage` 仅新增/调整偏好重置逻辑（不改变既有 key 的含义）

## 核心场景

### 需求: 视觉一致性（跨主题与偏好）
**模块:** ui / runtime

#### 场景: 主题 + 强调色组合切换
- 用户在浅色/深色之间切换，并切换不同强调色（violet/cyan/rose/amber/emerald/slate）
- 预期结果：按钮/卡片/焦点/追光/渐变边框等视觉元素同步变化且保持统一风格，不出现“主色变了但辅色/追光还停留在旧方案”的割裂感。

#### 场景: 高对比与低动效/低透明降级
- 用户开启高对比或减少动效/透明度
- 预期结果：可读性优先，边界更明确，动效与玻璃效果降级但信息层级不崩坏。

### 需求: 设置中心可控重置
**模块:** runtime

#### 场景: 只重置外观偏好
- 用户希望恢复默认外观（主题/对比度/强调色/密度/动效/透明度/粒子），但不想清空收藏/笔记/进度等数据
- 预期结果：提供独立按钮一键恢复外观默认，并有明确提示。

### 需求: Pages 部署可回归
**模块:** tooling / docs

#### 场景: 推送后自动部署
- 维护者 push 到默认分支后
- 预期结果：GitHub Actions Pages 流水线可执行、可诊断；文档提供清晰的仓库设置路径与排障信息。

